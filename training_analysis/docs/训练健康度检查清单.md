# GAD 训练健康度检查清单

## 使用说明

这个清单帮助你**客观评估训练状态**，避免因单一指标误导而做出错误的代码修改。

请根据你的 TensorBoard 数据，逐项检查并打分。

---

## 检查清单

### 第一部分：Critic 训练健康度（40分）

#### 1.1 d_acc 水平（10分）
- [ ] d_acc < 70%：**10分** - 理想状态
- [ ] d_acc 70-85%：**8分** - 良好状态
- [ ] d_acc 85-95%：**5分** - 可接受
- [ ] d_acc > 95%：**0分** - 需要进一步检查

**你的 d_acc**：96-99%
**得分**：0分

#### 1.2 score_diff 趋势（15分）
- [ ] 持续下降（例如：2.0 → 1.5 → 1.0）：**15分** - 优秀
- [ ] 缓慢下降（例如：2.0 → 1.9 → 1.8）：**10分** - 良好
- [ ] 基本不变（例如：2.0 → 2.0 → 2.0）：**5分** - 需要关注
- [ ] 上升（例如：2.0 → 2.2 → 2.5）：**0分** - 有问题

**你的 score_diff 趋势**：_____
**得分**：_____

#### 1.3 ranking_loss 趋势（10分）
- [ ] 持续上升（例如：0.3 → 0.5 → 0.7）：**10分** - 优秀
- [ ] 缓慢上升（例如：0.3 → 0.35 → 0.4）：**7分** - 良好
- [ ] 基本不变（例如：0.3 → 0.3 → 0.3）：**3分** - 需要关注
- [ ] 下降（例如：0.5 → 0.3 → 0.2）：**0分** - 有问题

**你的 ranking_loss 趋势**：_____
**得分**：_____

#### 1.4 绝对分数范围（5分）
- [ ] teacher_value 在 -2 到 2，student_value 在 -2 到 2：**5分** - 正常
- [ ] teacher_value 在 -5 到 5，student_value 在 -5 到 5：**3分** - 可接受
- [ ] 任一分数 > 5 或 < -5：**0分** - 数值漂移

**你的分数范围**：
- teacher_value_mean：_____
- student_value_mean：_____
**得分**：_____

---

### 第二部分：Actor 训练健康度（30分）

#### 2.1 format_reward 趋势（15分）
- [ ] 持续上升（例如：-0.8 → -0.5 → -0.2）：**15分** - 优秀
- [ ] 缓慢上升（例如：-0.5 → -0.45 → -0.4）：**10分** - 良好
- [ ] 基本不变（例如：-0.5 → -0.5 → -0.5）：**3分** - 需要关注
- [ ] 下降（例如：-0.3 → -0.5 → -0.7）：**0分** - 有问题

**你的 format_reward 趋势**：_____
**得分**：_____

#### 2.2 policy_loss 趋势（10分）
- [ ] 持续下降：**10分** - 优秀
- [ ] 缓慢下降：**7分** - 良好
- [ ] 基本不变：**3分** - 需要关注
- [ ] 上升：**0分** - 有问题

**你的 policy_loss 趋势**：_____
**得分**：_____

#### 2.3 KL divergence（5分）
- [ ] 在 0.01-0.1 之间：**5分** - 正常
- [ ] 在 0.1-0.5 之间：**3分** - 可接受
- [ ] > 0.5 或 < 0.001：**0分** - 有问题

**你的 KL divergence**：_____
**得分**：_____

---

### 第三部分：Loss 组件健康度（20分）

#### 3.1 score_reg 水平（7分）
- [ ] 在 0.01-0.1 之间：**7分** - 正常
- [ ] 在 0.001-0.01 之间：**4分** - 偏小
- [ ] < 0.001：**0分** - 太小

**你的 score_reg**：_____
**得分**：_____

#### 3.2 diff_penalty 水平（7分）
- [ ] 在 0-0.3 之间：**7分** - 正常
- [ ] 在 0.3-0.5 之间：**4分** - 偏高
- [ ] > 0.5：**0分** - 频繁触发

**你的 diff_penalty**：_____
**得分**：_____

#### 3.3 Loss 组件平衡（6分）
- [ ] ranking_loss 占主导（> 60%）：**6分** - 正常
- [ ] ranking_loss 占 40-60%：**3分** - 可接受
- [ ] ranking_loss < 40%：**0分** - 不平衡

**你的 loss 组成**：
- ranking_loss：_____
- score_reg：_____
- diff_penalty：_____
**得分**：_____

---

### 第四部分：训练稳定性（10分）

#### 4.1 指标波动性（5分）
- [ ] 所有指标平滑变化：**5分** - 稳定
- [ ] 有轻微波动但趋势明确：**3分** - 可接受
- [ ] 剧烈波动或震荡：**0分** - 不稳定

**你的波动情况**：_____
**得分**：_____

#### 4.2 训练步数（5分）
- [ ] > 500 steps：**5分** - 充分
- [ ] 200-500 steps：**3分** - 可接受
- [ ] < 200 steps：**0分** - 不足

**你的训练步数**：300 steps
**得分**：3分

---

## 总分评估

### 计算总分

```
第一部分：_____ / 40
第二部分：_____ / 30
第三部分：_____ / 20
第四部分：_____ / 10
─────────────────────
总分：_____ / 100
```

### 健康度评级

- **90-100分**：✅ **优秀** - 训练非常健康，继续保持
- **70-89分**：✅ **良好** - 训练基本健康，可以继续
- **50-69分**：⚠️ **需要关注** - 有一些问题，但不紧急
- **30-49分**：⚠️ **需要调整** - 存在明显问题，建议调整
- **< 30分**：❌ **需要修复** - 训练有严重问题，必须修改

---

## 决策建议

### 如果总分 >= 70分

**结论**：训练基本健康，d_acc 高是正常现象

**建议**：
1. ✅ **不要修改代码**
2. ✅ 继续训练，观察趋势
3. ✅ 定期检查 score_diff 和 format_reward

**原因**：
- d_acc 高是因为 teacher 和 student 质量差距确实大
- 这在训练初期是正常的
- 关键是看 student 是否在进步（format_reward 提升）

### 如果总分 50-69分

**结论**：训练有一些问题，但不紧急

**建议**：
1. 🔍 **先观察更多步数**（至少 500 steps）
2. 🔍 **重点关注 actor 训练**：
   - 如果 format_reward 不提升 → 检查 actor 配置
   - 如果 policy_loss 不下降 → 检查学习率
3. 🔍 **如果 500 steps 后仍无改善** → 考虑调整 temperature

**原因**：
- 300 steps 可能不足以看到明显趋势
- 问题可能在 actor 而不是 critic
- 需要更多数据才能做出准确判断

### 如果总分 < 50分

**结论**：训练存在明显问题

**建议**：
1. ⚠️ **优先检查 actor 训练**：
   - policy_loss 是否下降？
   - kl_divergence 是否正常？
   - format_reward 是否提升？

2. ⚠️ **检查 loss 组件**：
   - score_reg 是否太小？
   - diff_penalty 是否频繁触发？
   - 绝对分数是否漂移？

3. ⚠️ **如果确认是 critic 问题** → 考虑调整：
   - 增大 temperature（2.0 → 3.0）
   - 增大 score_reg（0.005 → 0.01）
   - 降低 diff_penalty 阈值（1.5 → 1.0）

**原因**：
- 多个指标都显示异常
- 需要系统性地排查问题
- 可能需要调整多个参数

---

## 特殊情况判断

### 情况1：d_acc 高但其他指标都正常

```
d_acc = 96-99%                    ⚠️
score_diff 逐渐减小               ✓
format_reward 逐渐提升            ✓
ranking_loss 逐渐增大             ✓
绝对分数在合理范围                ✓
```

**结论**：**这是正常的！不需要修改代码。**

**解释**：
- d_acc 高是因为质量差距确实大
- Critic 正确地学会了区分
- Student 正在进步（score_diff 缩小，format_reward 提升）
- 随着训练继续，d_acc 会自然下降

### 情况2：d_acc 高且 score_diff 不收敛

```
d_acc = 96-99%                    ⚠️
score_diff 维持高位               ⚠️
format_reward 不提升              ⚠️
ranking_loss 维持低位             ⚠️
```

**结论**：**可能有问题，但先检查 actor。**

**解释**：
- Student 没有进步（format_reward 不提升）
- 可能是 actor 训练有问题，而不是 critic
- 先检查 actor 的 policy_loss 和 kl_divergence
- 如果 actor 正常，再考虑调整 critic

### 情况3：d_acc 高且分数漂移

```
d_acc = 96-99%                         ⚠️
teacher_value_mean > 5                 ⚠️
student_value_mean < -5                ⚠️
score_reg < 0.01                       ⚠️
diff_penalty > 0.5                     ⚠️
```

**结论**：**Loss 设计有问题，需要修改。**

**解释**：
- 分数漂移到极端值
- score_reg 太小，无法约束
- diff_penalty 频繁触发但无效
- 需要增大 score_reg 和降低 diff_penalty 阈值

---

## 你的训练状态评估

基于你提供的信息：

### 已知信息
- ✅ d_acc = 96-99%（step 0-300）
- ✅ 训练步数 = 300 steps
- ❓ score_diff 趋势 = 未知
- ❓ format_reward 趋势 = 未知
- ❓ ranking_loss 趋势 = 未知
- ❓ 绝对分数范围 = 未知

### 初步评估

**无法做出准确判断**，因为缺少关键指标。

### 下一步行动

请提供以下指标的数据（可以是截图或数值）：

1. **critic/score_diff**（step 0-300 的曲线）
2. **actor/format_reward_mean**（step 0-300 的曲线）
3. **critic/ranking_loss**（step 0-300 的曲线）
4. **critic/teacher_value_mean** 和 **student_value_mean**（最新值）

有了这些数据，我可以：
- 计算你的健康度总分
- 给出明确的建议（是否需要修改代码）
- 如果需要修改，给出具体的修改方案

---

## 总结

### 核心原则

1. **多指标综合判断**：不要只看 d_acc
2. **关注趋势而非绝对值**：score_diff 是否缩小比 d_acc 是否高更重要
3. **验证 student 进步**：format_reward 是最直接的证据
4. **保守修改**：先观察，再调整，小步快跑

### 避免误判的关键

- ❌ 错误：d_acc 高 → 立即修改 temperature
- ✅ 正确：d_acc 高 → 检查其他指标 → 综合判断 → 谨慎修改

### 记住

**d_acc 高不一定是坏事！**

如果 student 正在进步（format_reward 提升，score_diff 缩小），那么 d_acc 高只是说明当前质量差距大，这是正常的训练过程。
